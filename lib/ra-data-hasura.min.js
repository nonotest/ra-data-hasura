!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("ra-data-hasura",[],r):"object"==typeof exports?exports["ra-data-hasura"]=r():e["ra-data-hasura"]=r()}("undefined"!=typeof self?self:this,(function(){return function(e){var r={};function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=r,a.d=function(e,r,t){a.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,r){if(1&r&&(e=a(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)a.d(t,n,function(r){return e[r]}.bind(null,n));return t},a.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},a.p="",a(a.s=0)}([function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var t=a(1);var n=function(e){return JSON.parse(JSON.stringify(e))};r.default=function(e,r,a){var s=function(e){var r="id";return a&&a.primaryKey[e]&&(r=a.primaryKey[e]),r},u=function(e,r){if(!r)return e;var a=Object.keys(r);if(0===a.length)return e;var t=Object.assign(e);return a.forEach((function(e){t[e]=r[e]})),t},i=function(e,r,a){var i,o,c,l={},g={},f=function(e){var r,a;if(e&&1===e.split(".").length)a="public",r=e;else{if(!e||2!==e.split(".").length)throw new Error(JSON.stringify({error:"Invalid table/schema resource"}));var t=e.split(".");a=t[0],r=t[1]}return{schema:a,tableName:r}}(r),d=f.schema,h=f.tableName,p=s(r);switch(e){case"GET_LIST":var y=n(t.selectQuery),b=n(t.countQuery);if(a.filter&&a.filter.q){var m=a.filter.q;delete a.filter.q,a.filter={...a.filter,...m}}y.args.table={name:h,schema:d},y.args.limit=a.pagination.perPage,y.args.offset=a.pagination.page*a.pagination.perPage-a.pagination.perPage,y.args.where=a.filter,y.args.order_by={column:a.sort.field||p,type:void 0===a.sort.order?"asc":a.sort.order.toLowerCase()},b.args.table={name:h,schema:d},b.args.where={},b.args.where[p]={$ne:null},b.args.where=u(b.args.where,a.filter),(g=n(t.bulkQuery)).args.push(y),g.args.push(b);break;case"GET_ONE":(g=n(t.selectQuery)).args.table={name:h,schema:d},g.args.where={},g.args.where[p]={$eq:a.id};break;case"CREATE":var w=Object.keys(a.data);(g=n(t.insertQuery)).args.table={name:h,schema:d},g.args.objects.push(a.data),w.push(p),g.args.returning=w;break;case"UPDATE":var E=Object.keys(a.data);(g=n(t.updateQuery)).args.table={name:h,schema:d},g.args.$set=a.data,g.args.where={},g.args.where[p]={$eq:a.id},E.push(p),g.args.returning=E;break;case"UPDATE_MANY":var v=Object.keys(a.data);(g=n(t.updateQuery)).args.table={name:h,schema:d},g.args.$set=a.data,g.args.where={},g.args.where[p]={$in:a.ids},v.push(p),g.args.returning=v;break;case"DELETE":var Q=Object.keys(a.previousData);(g=n(t.deleteQuery)).args.table={name:h,schema:d},g.args.where={},g.args.where[p]={$eq:a.id},Q.push(p),g.args.returning=Q;break;case"DELETE_MANY":(g=n(t.deleteQuery)).args.table={name:h,schema:d},g.args.where={},g.args.where[p]={$in:a.ids},g.args.returning=[p];break;case"GET_MANY":var _=n(t.selectQuery),O=n(t.countQuery);_.args.table={name:h,schema:d},_.args.where={},_.args.where[p]={$in:a.ids},_.args.where=u(_.args.where,a.filter),O.args.table={name:h,schema:d},O.args.where={},O.args.where[p]={$ne:null},O.args.where=u(O.args.where,a.filter),(g=n(t.bulkQuery)).args.push(_),g.args.push(O);break;case"GET_MANY_REFERENCE":var j=n(t.selectQuery),T=n(t.countQuery);j.args.table={name:h,schema:d},j.args.limit=a.pagination.perPage,j.args.offset=a.pagination.page*a.pagination.perPage-a.pagination.perPage,j.args.where=(i={},o=a.target,c=a.id,o in i?Object.defineProperty(i,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):i[o]=c,i),j.args.where=u(j.args.where,a.filter),j.args.order_by={column:a.sort.field||p,type:void 0===a.sort.order?"asc":a.sort.order.toLowerCase()},T.args.table={name:h,schema:d},T.args.where={},T.args.where[p]={$ne:null},T.args.where=u(j.args.where,a.filter),(g=n(t.bulkQuery)).args.push(j),g.args.push(T);break;default:throw new Error("Unsupported type ".concat(e))}return l.body=JSON.stringify(g),{options:l}},o=function(e,r,a,t){if("error"in e||"code"in e)throw new Error(JSON.stringify(e));var n=s(a);switch("id"!==n&&(Array.isArray(e[0])?e[0].forEach((function(e){e.id=e[n]})):e[0].id=e[0][n]),r){case"GET_LIST":return{data:e[0],total:e[1].count};case"GET_ONE":return{data:e[0]};case"CREATE":case"UPDATE":return{data:e.returning[0]};case"UPDATE_MANY":return{data:e.returning.map((function(e){return e.id}))};case"DELETE":return{data:e.returning[0]};case"DELETE_MANY":return{data:e.returning.map((function(e){return e.id}))};case"GET_MANY":return{data:e[0]};case"GET_MANY_REFERENCE":return{data:e[0],total:e[1].count};default:return{data:e}}};return function(a,t,n){var s=i(a,t,n).options;return s.method="POST","function"==typeof r?r(e+"/v1/query",s).then((function(e){return o(e.json,a,t)})):(s.headers=r,fetch(e+"/v1/query",s).then((function(e){return e.json().then((function(e){return o(e,a,t)}))})))}},e.exports=r.default},function(e,r,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deleteQuery=r.updateQuery=r.insertQuery=r.countQuery=r.selectQuery=r.bulkQuery=void 0;r.bulkQuery={type:"bulk",args:[]};r.selectQuery={type:"select",args:{table:{schema:"",name:""},columns:["*"]}};r.countQuery={type:"count",args:{table:{schema:"",name:""},where:{}}};r.insertQuery={type:"insert",args:{table:{schema:"",name:""},objects:[],returning:[]}};r.updateQuery={type:"update",args:{table:{schema:"",name:""},$set:{},where:{},returning:[]}};r.deleteQuery={type:"delete",args:{table:{schema:"",name:""},$set:{},where:{},returning:[]}}}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYS1kYXRhLWhhc3VyYS93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vcmEtZGF0YS1oYXN1cmEvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vcmEtZGF0YS1oYXN1cmEvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcmEtZGF0YS1oYXN1cmEvLi9zcmMvcXVlcmllcy5qcyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJzZWxmIiwidGhpcyIsImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJjbG9uZVF1ZXJ5IiwicXVlcnkiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJzZXJ2ZXJFbmRwb2ludCIsImh0dHBDbGllbnQiLCJjb25maWciLCJnZXRQcmltYXJ5S2V5IiwicmVzb3VyY2UiLCJwcmltYXJ5S2V5IiwiYWRkRmlsdGVycyIsIndoZXJlIiwiZmlsdGVyIiwiZmlsdGVyS2V5cyIsImtleXMiLCJsZW5ndGgiLCJ3aGVyZUNvcHkiLCJhc3NpZ24iLCJmb3JFYWNoIiwiY29udmVydERhdGFSZXF1ZXN0VG9IVFRQIiwidHlwZSIsInBhcmFtcyIsIm9wdGlvbnMiLCJmaW5hbFF1ZXJ5IiwidGFibGVTY2hlbWEiLCJ0YWJsZU5hbWUiLCJzY2hlbWEiLCJzcGxpdCIsIkVycm9yIiwiZXJyb3IiLCJyZXNvdXJjZVNwbGl0IiwiZ2V0VGFibGVTY2hlbWEiLCJmaW5hbFNlbGVjdFF1ZXJ5IiwiZmluYWxDb3VudFF1ZXJ5IiwicSIsImFyZ3MiLCJ0YWJsZSIsImxpbWl0IiwicGFnaW5hdGlvbiIsInBlclBhZ2UiLCJvZmZzZXQiLCJwYWdlIiwib3JkZXJfYnkiLCJjb2x1bW4iLCJzb3J0IiwiZmllbGQiLCJvcmRlciIsInRvTG93ZXJDYXNlIiwiJG5lIiwicHVzaCIsIiRlcSIsImlkIiwiY3JlYXRlRmllbGRzIiwiZGF0YSIsIm9iamVjdHMiLCJyZXR1cm5pbmciLCJ1cGRhdGVGaWVsZHMiLCJ1cGRhdGVNYW55RmllbGRzIiwiJGluIiwiaWRzIiwiZGVsZXRlRmllbGRzIiwicHJldmlvdXNEYXRhIiwiZmluYWxNYW55UXVlcnkiLCJmaW5hbE1hbnlDb3VudFF1ZXJ5IiwiZmluYWxNYW55UmVmUXVlcnkiLCJmaW5hbE1hbnlSZWZDb3VudFF1ZXJ5IiwidGFyZ2V0IiwiYm9keSIsImNvbnZlcnRIVFRQUmVzcG9uc2UiLCJyZXNwb25zZSIsIkFycmF5IiwiaXNBcnJheSIsInJlcyIsInRvdGFsIiwibWFwIiwiaXRlbSIsImNvdW50IiwibWV0aG9kIiwidGhlbiIsImpzb24iLCJoZWFkZXJzIiwiZmV0Y2giLCJjb2x1bW5zIiwiJHNldCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBMkNBLEVBQU1DLEdBQzFCLGlCQUFaQyxTQUEwQyxpQkFBWEMsT0FDeENBLE9BQU9ELFFBQVVELElBQ1EsbUJBQVhHLFFBQXlCQSxPQUFPQyxJQUM5Q0QsT0FBTyxpQkFBa0IsR0FBSUgsR0FDSCxpQkFBWkMsUUFDZEEsUUFBUSxrQkFBb0JELElBRTVCRCxFQUFLLGtCQUFvQkMsSUFSM0IsQ0FTbUIsb0JBQVRLLEtBQXVCQSxLQUFPQyxNQUFNLFdBQzlDLE8sWUNURSxJQUFJQyxFQUFtQixHQUd2QixTQUFTQyxFQUFvQkMsR0FHNUIsR0FBR0YsRUFBaUJFLEdBQ25CLE9BQU9GLEVBQWlCRSxHQUFVUixRQUduQyxJQUFJQyxFQUFTSyxFQUFpQkUsR0FBWSxDQUN6Q0MsRUFBR0QsRUFDSEUsR0FBRyxFQUNIVixRQUFTLElBVVYsT0FOQVcsRUFBUUgsR0FBVUksS0FBS1gsRUFBT0QsUUFBU0MsRUFBUUEsRUFBT0QsUUFBU08sR0FHL0ROLEVBQU9TLEdBQUksRUFHSlQsRUFBT0QsUUEwRGYsT0FyREFPLEVBQW9CTSxFQUFJRixFQUd4QkosRUFBb0JPLEVBQUlSLEVBR3hCQyxFQUFvQlEsRUFBSSxTQUFTZixFQUFTZ0IsRUFBTUMsR0FDM0NWLEVBQW9CVyxFQUFFbEIsRUFBU2dCLElBQ2xDRyxPQUFPQyxlQUFlcEIsRUFBU2dCLEVBQU0sQ0FBRUssWUFBWSxFQUFNQyxJQUFLTCxLQUtoRVYsRUFBb0JnQixFQUFJLFNBQVN2QixHQUNYLG9CQUFYd0IsUUFBMEJBLE9BQU9DLGFBQzFDTixPQUFPQyxlQUFlcEIsRUFBU3dCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZXBCLEVBQVMsYUFBYyxDQUFFMEIsT0FBTyxLQVF2RG5CLEVBQW9Cb0IsRUFBSSxTQUFTRCxFQUFPRSxHQUV2QyxHQURVLEVBQVBBLElBQVVGLEVBQVFuQixFQUFvQm1CLElBQy9CLEVBQVBFLEVBQVUsT0FBT0YsRUFDcEIsR0FBVyxFQUFQRSxHQUE4QixpQkFBVkYsR0FBc0JBLEdBQVNBLEVBQU1HLFdBQVksT0FBT0gsRUFDaEYsSUFBSUksRUFBS1gsT0FBT1ksT0FBTyxNQUd2QixHQUZBeEIsRUFBb0JnQixFQUFFTyxHQUN0QlgsT0FBT0MsZUFBZVUsRUFBSSxVQUFXLENBQUVULFlBQVksRUFBTUssTUFBT0EsSUFDdEQsRUFBUEUsR0FBNEIsaUJBQVRGLEVBQW1CLElBQUksSUFBSU0sS0FBT04sRUFBT25CLEVBQW9CUSxFQUFFZSxFQUFJRSxFQUFLLFNBQVNBLEdBQU8sT0FBT04sRUFBTU0sSUFBUUMsS0FBSyxLQUFNRCxJQUM5SSxPQUFPRixHQUlSdkIsRUFBb0IyQixFQUFJLFNBQVNqQyxHQUNoQyxJQUFJZ0IsRUFBU2hCLEdBQVVBLEVBQU80QixXQUM3QixXQUF3QixPQUFPNUIsRUFBZ0IsU0FDL0MsV0FBOEIsT0FBT0EsR0FFdEMsT0FEQU0sRUFBb0JRLEVBQUVFLEVBQVEsSUFBS0EsR0FDNUJBLEdBSVJWLEVBQW9CVyxFQUFJLFNBQVNpQixFQUFRQyxHQUFZLE9BQU9qQixPQUFPa0IsVUFBVUMsZUFBZTFCLEtBQUt1QixFQUFRQyxJQUd6RzdCLEVBQW9CZ0MsRUFBSSxHQUlqQmhDLEVBQW9CQSxFQUFvQmlDLEVBQUksRyxpR0NsRnJELFdBU0EsSUFFTUMsRUFBYSxTQUFBQyxHQUNqQixPQUFPQyxLQUFLQyxNQUFNRCxLQUFLRSxVQUFVSCxLLFVBR3BCLFNBQUNJLEVBQWdCQyxFQUFZQyxHQUMxQyxJQXFCTUMsRUFBZ0IsU0FBQUMsR0FDcEIsSUFBSUMsRUE3Qm9CLEtBa0N4QixPQUhJSCxHQUFVQSxFQUFNLFdBQWVFLEtBQ2pDQyxFQUFhSCxFQUFNLFdBQWVFLElBRTdCQyxHQUdIQyxFQUFhLFNBQUNDLEVBQU9DLEdBQ3pCLElBQUtBLEVBQVEsT0FBT0QsRUFFcEIsSUFBTUUsRUFBYXBDLE9BQU9xQyxLQUFLRixHQUUvQixHQUEwQixJQUF0QkMsRUFBV0UsT0FBYyxPQUFPSixFQUVwQyxJQUFNSyxFQUFZdkMsT0FBT3dDLE9BQU9OLEdBS2hDLE9BSEFFLEVBQVdLLFNBQVEsU0FBQTVCLEdBQ2pCMEIsRUFBVTFCLEdBQU9zQixFQUFPdEIsTUFFbkIwQixHQUdIRyxFQUEyQixTQUFDQyxFQUFNWixFQUFVYSxHQUNoRCxJLE1BQU1DLEVBQVUsR0FDWkMsRUFBYSxHQUVYQyxFQWpEZSxTQUFBaEIsR0FDckIsSUFBSWlCLEVBQ0FDLEVBR0osR0FBSWxCLEdBQTJDLElBQS9CQSxFQUFTbUIsTUFBTSxLQUFLWixPQUNsQ1csRUFBUyxTQUNURCxFQUFZakIsTUFDUCxLQUFJQSxHQUEyQyxJQUEvQkEsRUFBU21CLE1BQU0sS0FBS1osT0FNekMsTUFBTSxJQUFJYSxNQUNSM0IsS0FBS0UsVUFBVSxDQUFFMEIsTUFBTyxtQ0FOMUIsSUFBTUMsRUFBZ0J0QixFQUFTbUIsTUFBTSxLQUVyQ0QsRUFBU0ksRUFBYyxHQUN2QkwsRUFBWUssRUFBYyxHQU01QixNQUFPLENBQUVKLFNBQVFELGFBK0JHTSxDQUFldkIsR0FFN0JrQixFQUFzQkYsRUFBdEJFLE9BQVFELEVBQWNELEVBQWRDLFVBRVJoQixFQUFhRixFQUFjQyxHQUVqQyxPQUFRWSxHQUNOLElBQUssV0FFSCxJQUFNWSxFQUFtQmpDLEVBQVcsRUFBRCxhQUM3QmtDLEVBQWtCbEMsRUFBVyxFQUFELFlBR2xDLEdBQUlzQixFQUFPVCxRQUFVUyxFQUFPVCxPQUFPc0IsRUFBRyxLQUM1QkEsRUFBTWIsRUFBT1QsT0FBYnNCLFNBRURiLEVBQU9ULE9BQVAsRUFFUFMsRUFBT1QsT0FBUyxJQUNYUyxFQUFPVCxVQUNQc0IsR0FJUEYsRUFBaUJHLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUN6RE0sRUFBaUJHLEtBQUtFLE1BQVFoQixFQUFPaUIsV0FBV0MsUUFDaERQLEVBQWlCRyxLQUFLSyxPQUNwQm5CLEVBQU9pQixXQUFXRyxLQUFPcEIsRUFBT2lCLFdBQVdDLFFBQzNDbEIsRUFBT2lCLFdBQVdDLFFBQ3BCUCxFQUFpQkcsS0FBS3hCLE1BQVFVLEVBQU9ULE9BQ3JDb0IsRUFBaUJHLEtBQUtPLFNBQVcsQ0FDL0JDLE9BQVF0QixFQUFPdUIsS0FBS0MsT0FBU3BDLEVBQzdCVyxVQUMrQixJQUF0QkMsRUFBT3VCLEtBQUtFLE1BQ2YsTUFDQXpCLEVBQU91QixLQUFLRSxNQUFNQyxlQUUxQmQsRUFBZ0JFLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUN4RE8sRUFBZ0JFLEtBQUt4QixNQUFRLEdBQzdCc0IsRUFBZ0JFLEtBQUt4QixNQUFNRixHQUFjLENBQUV1QyxJQUFLLE1BQ2hEZixFQUFnQkUsS0FBS3hCLE1BQVFELEVBQzNCdUIsRUFBZ0JFLEtBQUt4QixNQUNyQlUsRUFBT1QsU0FFVFcsRUFBYXhCLEVBQVcsRUFBRCxZQUNab0MsS0FBS2MsS0FBS2pCLEdBQ3JCVCxFQUFXWSxLQUFLYyxLQUFLaEIsR0FDckIsTUFDRixJQUFLLFdBRUhWLEVBQWF4QixFQUFXLEVBQUQsY0FDWm9DLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUNuREgsRUFBV1ksS0FBS3hCLE1BQVEsR0FDeEJZLEVBQVdZLEtBQUt4QixNQUFNRixHQUFjLENBQUV5QyxJQUFLN0IsRUFBTzhCLElBQ2xELE1BQ0YsSUFBSyxTQUVILElBQU1DLEVBQWUzRSxPQUFPcUMsS0FBS08sRUFBT2dDLE9BRXhDOUIsRUFBYXhCLEVBQVcsRUFBRCxjQUNab0MsS0FBS0MsTUFBUSxDQUFFOUQsS0FBTW1ELEVBQVdDLE9BQVFBLEdBQ25ESCxFQUFXWSxLQUFLbUIsUUFBUUwsS0FBSzVCLEVBQU9nQyxNQUNwQ0QsRUFBYUgsS0FBS3hDLEdBQ2xCYyxFQUFXWSxLQUFLb0IsVUFBWUgsRUFDNUIsTUFDRixJQUFLLFNBRUgsSUFBTUksRUFBZS9FLE9BQU9xQyxLQUFLTyxFQUFPZ0MsT0FFeEM5QixFQUFheEIsRUFBVyxFQUFELGNBQ1pvQyxLQUFLQyxNQUFRLENBQUU5RCxLQUFNbUQsRUFBV0MsT0FBUUEsR0FDbkRILEVBQVdZLEtBQVgsS0FBMEJkLEVBQU9nQyxLQUNqQzlCLEVBQVdZLEtBQUt4QixNQUFRLEdBQ3hCWSxFQUFXWSxLQUFLeEIsTUFBTUYsR0FBYyxDQUFFeUMsSUFBSzdCLEVBQU84QixJQUNsREssRUFBYVAsS0FBS3hDLEdBQ2xCYyxFQUFXWSxLQUFLb0IsVUFBWUMsRUFDNUIsTUFDRixJQUFLLGNBRUgsSUFBTUMsRUFBbUJoRixPQUFPcUMsS0FBS08sRUFBT2dDLE9BRTVDOUIsRUFBYXhCLEVBQVcsRUFBRCxjQUNab0MsS0FBS0MsTUFBUSxDQUFFOUQsS0FBTW1ELEVBQVdDLE9BQVFBLEdBQ25ESCxFQUFXWSxLQUFYLEtBQTBCZCxFQUFPZ0MsS0FDakM5QixFQUFXWSxLQUFLeEIsTUFBUSxHQUN4QlksRUFBV1ksS0FBS3hCLE1BQU1GLEdBQWMsQ0FBRWlELElBQUtyQyxFQUFPc0MsS0FDbERGLEVBQWlCUixLQUFLeEMsR0FDdEJjLEVBQVdZLEtBQUtvQixVQUFZRSxFQUM1QixNQUNGLElBQUssU0FFSCxJQUFNRyxFQUFlbkYsT0FBT3FDLEtBQUtPLEVBQU93QyxlQUV4Q3RDLEVBQWF4QixFQUFXLEVBQUQsY0FDWm9DLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUNuREgsRUFBV1ksS0FBS3hCLE1BQVEsR0FDeEJZLEVBQVdZLEtBQUt4QixNQUFNRixHQUFjLENBQUV5QyxJQUFLN0IsRUFBTzhCLElBQ2xEUyxFQUFhWCxLQUFLeEMsR0FDbEJjLEVBQVdZLEtBQUtvQixVQUFZSyxFQUM1QixNQUNGLElBQUssZUFFSHJDLEVBQWF4QixFQUFXLEVBQUQsY0FDWm9DLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUNuREgsRUFBV1ksS0FBS3hCLE1BQVEsR0FDeEJZLEVBQVdZLEtBQUt4QixNQUFNRixHQUFjLENBQUVpRCxJQUFLckMsRUFBT3NDLEtBQ2xEcEMsRUFBV1ksS0FBS29CLFVBQVksQ0FBQzlDLEdBQzdCLE1BQ0YsSUFBSyxXQUVILElBQU1xRCxFQUFpQi9ELEVBQVcsRUFBRCxhQUMzQmdFLEVBQXNCaEUsRUFBVyxFQUFELFlBRXRDK0QsRUFBZTNCLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUN2RG9DLEVBQWUzQixLQUFLeEIsTUFBUSxHQUM1Qm1ELEVBQWUzQixLQUFLeEIsTUFBTUYsR0FBYyxDQUFFaUQsSUFBS3JDLEVBQU9zQyxLQUN0REcsRUFBZTNCLEtBQUt4QixNQUFRRCxFQUMxQm9ELEVBQWUzQixLQUFLeEIsTUFDcEJVLEVBQU9ULFFBR1RtRCxFQUFvQjVCLEtBQUtDLE1BQVEsQ0FBRTlELEtBQU1tRCxFQUFXQyxPQUFRQSxHQUM1RHFDLEVBQW9CNUIsS0FBS3hCLE1BQVEsR0FDakNvRCxFQUFvQjVCLEtBQUt4QixNQUFNRixHQUFjLENBQUV1QyxJQUFLLE1BQ3BEZSxFQUFvQjVCLEtBQUt4QixNQUFRRCxFQUMvQnFELEVBQW9CNUIsS0FBS3hCLE1BQ3pCVSxFQUFPVCxTQUdUVyxFQUFheEIsRUFBVyxFQUFELFlBQ1pvQyxLQUFLYyxLQUFLYSxHQUNyQnZDLEVBQVdZLEtBQUtjLEtBQUtjLEdBQ3JCLE1BQ0YsSUFBSyxxQkFFSCxJQUFNQyxFQUFvQmpFLEVBQVcsRUFBRCxhQUM5QmtFLEVBQXlCbEUsRUFBVyxFQUFELFlBRXpDaUUsRUFBa0I3QixLQUFLQyxNQUFRLENBQUU5RCxLQUFNbUQsRUFBV0MsT0FBUUEsR0FDMURzQyxFQUFrQjdCLEtBQUtFLE1BQVFoQixFQUFPaUIsV0FBV0MsUUFDakR5QixFQUFrQjdCLEtBQUtLLE9BQ3JCbkIsRUFBT2lCLFdBQVdHLEtBQU9wQixFQUFPaUIsV0FBV0MsUUFDM0NsQixFQUFPaUIsV0FBV0MsUUFDcEJ5QixFQUFrQjdCLEtBQUt4QixPLEVBQXZCLEcsRUFBa0NVLEVBQU82QyxPLEVBQVM3QyxFQUFPOEIsRyxnR0FDekRhLEVBQWtCN0IsS0FBS3hCLE1BQVFELEVBQzdCc0QsRUFBa0I3QixLQUFLeEIsTUFDdkJVLEVBQU9ULFFBRVRvRCxFQUFrQjdCLEtBQUtPLFNBQVcsQ0FDaENDLE9BQVF0QixFQUFPdUIsS0FBS0MsT0FBU3BDLEVBQzdCVyxVQUMrQixJQUF0QkMsRUFBT3VCLEtBQUtFLE1BQ2YsTUFDQXpCLEVBQU91QixLQUFLRSxNQUFNQyxlQUUxQmtCLEVBQXVCOUIsS0FBS0MsTUFBUSxDQUFFOUQsS0FBTW1ELEVBQVdDLE9BQVFBLEdBQy9EdUMsRUFBdUI5QixLQUFLeEIsTUFBUSxHQUNwQ3NELEVBQXVCOUIsS0FBS3hCLE1BQU1GLEdBQWMsQ0FBRXVDLElBQUssTUFDdkRpQixFQUF1QjlCLEtBQUt4QixNQUFRRCxFQUNsQ3NELEVBQWtCN0IsS0FBS3hCLE1BQ3ZCVSxFQUFPVCxTQUVUVyxFQUFheEIsRUFBVyxFQUFELFlBQ1pvQyxLQUFLYyxLQUFLZSxHQUNyQnpDLEVBQVdZLEtBQUtjLEtBQUtnQixHQUNyQixNQUNGLFFBQ0UsTUFBTSxJQUFJckMsTUFBSiwyQkFBOEJSLElBR3hDLE9BREFFLEVBQVE2QyxLQUFPbEUsS0FBS0UsVUFBVW9CLEdBQ3ZCLENBQUVELFlBR0w4QyxFQUFzQixTQUFDQyxFQUFVakQsRUFBTVosRUFBVWEsR0FFckQsR0FBSSxVQUFXZ0QsR0FBWSxTQUFVQSxFQUNuQyxNQUFNLElBQUl6QyxNQUFNM0IsS0FBS0UsVUFBVWtFLElBRWpDLElBQU01RCxFQUFhRixFQUFjQyxHQVdqQyxPQXJQd0IsT0E0T3BCQyxJQUNFNkQsTUFBTUMsUUFBUUYsRUFBUyxJQUN6QkEsRUFBUyxHQUFHbkQsU0FBUSxTQUFBc0QsR0FDbEJBLEVBQUcsR0FBd0JBLEVBQUkvRCxNQUdqQzRELEVBQVMsR0FBVCxHQUFtQ0EsRUFBUyxHQUFHNUQsSUFHM0NXLEdBQ04sSUFBSyxXQUNILE1BQU8sQ0FDTGlDLEtBQU1nQixFQUFTLEdBQ2ZJLE1BQU9KLEVBQVMsR0FBVCxPQUVYLElBQUssVUFDSCxNQUFPLENBQ0xoQixLQUFNZ0IsRUFBUyxJQUVuQixJQUFLLFNBSUwsSUFBSyxTQUNILE1BQU8sQ0FDTGhCLEtBQU1nQixFQUFTZCxVQUFVLElBRTdCLElBQUssY0FLSCxNQUFPLENBQ0xGLEtBTGlCZ0IsRUFBU2QsVUFBVW1CLEtBQUksU0FBQUMsR0FDeEMsT0FBT0EsRUFBS3hCLE9BTWhCLElBQUssU0FDSCxNQUFPLENBQ0xFLEtBQU1nQixFQUFTZCxVQUFVLElBRTdCLElBQUssY0FLSCxNQUFPLENBQ0xGLEtBTGlCZ0IsRUFBU2QsVUFBVW1CLEtBQUksU0FBQUMsR0FDeEMsT0FBT0EsRUFBS3hCLE9BTWhCLElBQUssV0FDSCxNQUFPLENBQ0xFLEtBQU1nQixFQUFTLElBRW5CLElBQUsscUJBQ0gsTUFBTyxDQUNMaEIsS0FBTWdCLEVBQVMsR0FDZkksTUFBT0osRUFBUyxHQUFHTyxPQUV2QixRQUNFLE1BQU8sQ0FBRXZCLEtBQU1nQixLQUlyQixPQUFPLFNBQUNqRCxFQUFNWixFQUFVYSxHQUFXLElBQ3pCQyxFQUFZSCxFQUF5QkMsRUFBTVosRUFBVWEsR0FBckRDLFFBR1IsT0FEQUEsRUFBUXVELE9BQVMsT0FDUyxtQkFBZnhFLEVBRUZBLEVBQVdELEVBQWlCLFlBQWFrQixHQUFTd0QsTUFBSyxTQUFBVCxHQUFRLE9BQ3BFRCxFQUFvQkMsRUFBU1UsS0FBTTNELEVBQU1aLE9BSTdDYyxFQUFRMEQsUUFBVTNFLEVBQ1g0RSxNQUFNN0UsRUFBaUIsWUFBYWtCLEdBQVN3RCxNQUFLLFNBQ3ZEVCxHQUVBLE9BQU9BLEVBQVNVLE9BQU9ELE1BQUssU0FBQXpCLEdBQzFCLE9BQU9lLEVBQW9CZixFQUFNakMsRUFBTVosWSx1TUNqVTdCLENBQ2hCWSxLQUFNLE9BQ05lLEtBQU0sSSxjQUdZLENBQ2xCZixLQUFNLFNBQ05lLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCOEMsUUFBUyxDQUFDLE8sYUFJSyxDQUNqQjlELEtBQU0sUUFDTmUsS0FBTSxDQUNKQyxNQUFPLENBQUMsT0FBVSxHQUFJLEtBQVEsSUFDOUJ6QixNQUFPLEssY0FJUyxDQUNsQlMsS0FBTSxTQUNOZSxLQUFNLENBQ0pDLE1BQU8sQ0FBQyxPQUFVLEdBQUksS0FBUSxJQUM5QmtCLFFBQVMsR0FDVEMsVUFBVyxLLGNBSUssQ0FDbEJuQyxLQUFNLFNBQ05lLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCK0MsS0FBTSxHQUNOeEUsTUFBTyxHQUNQNEMsVUFBVyxLLGNBSUssQ0FDbEJuQyxLQUFNLFNBQ05lLEtBQU0sQ0FDSkMsTUFBTyxDQUFDLE9BQVUsR0FBSSxLQUFRLElBQzlCK0MsS0FBTSxHQUNOeEUsTUFBTyxHQUNQNEMsVUFBVyIsImZpbGUiOiJyYS1kYXRhLWhhc3VyYS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcInJhLWRhdGEtaGFzdXJhXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcInJhLWRhdGEtaGFzdXJhXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcInJhLWRhdGEtaGFzdXJhXCJdID0gZmFjdG9yeSgpO1xufSkodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHRoaXMsIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7XG4gIGJ1bGtRdWVyeSxcbiAgc2VsZWN0UXVlcnksXG4gIGNvdW50UXVlcnksXG4gIGluc2VydFF1ZXJ5LFxuICB1cGRhdGVRdWVyeSxcbiAgZGVsZXRlUXVlcnlcbn0gZnJvbSAnLi9xdWVyaWVzJ1xuXG5jb25zdCBERUZBVUxUX1BSSU1BUllfS0VZID0gJ2lkJ1xuXG5jb25zdCBjbG9uZVF1ZXJ5ID0gcXVlcnkgPT4ge1xuICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShxdWVyeSkpXG59XG5cbmV4cG9ydCBkZWZhdWx0IChzZXJ2ZXJFbmRwb2ludCwgaHR0cENsaWVudCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGdldFRhYmxlU2NoZW1hID0gcmVzb3VyY2UgPT4ge1xuICAgIGxldCB0YWJsZU5hbWVcbiAgICBsZXQgc2NoZW1hXG5cbiAgICAvLyBwYXJzZSBzY2hlbWEgaW4gcmVzb3VyY2VcbiAgICBpZiAocmVzb3VyY2UgJiYgcmVzb3VyY2Uuc3BsaXQoJy4nKS5sZW5ndGggPT09IDEpIHtcbiAgICAgIHNjaGVtYSA9ICdwdWJsaWMnXG4gICAgICB0YWJsZU5hbWUgPSByZXNvdXJjZVxuICAgIH0gZWxzZSBpZiAocmVzb3VyY2UgJiYgcmVzb3VyY2Uuc3BsaXQoJy4nKS5sZW5ndGggPT09IDIpIHtcbiAgICAgIGNvbnN0IHJlc291cmNlU3BsaXQgPSByZXNvdXJjZS5zcGxpdCgnLicpXG5cbiAgICAgIHNjaGVtYSA9IHJlc291cmNlU3BsaXRbMF1cbiAgICAgIHRhYmxlTmFtZSA9IHJlc291cmNlU3BsaXRbMV1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7IGVycm9yOiAnSW52YWxpZCB0YWJsZS9zY2hlbWEgcmVzb3VyY2UnIH0pXG4gICAgICApXG4gICAgfVxuICAgIHJldHVybiB7IHNjaGVtYSwgdGFibGVOYW1lIH1cbiAgfVxuXG4gIGNvbnN0IGdldFByaW1hcnlLZXkgPSByZXNvdXJjZSA9PiB7XG4gICAgbGV0IHByaW1hcnlLZXkgPSBERUZBVUxUX1BSSU1BUllfS0VZXG5cbiAgICBpZiAoY29uZmlnICYmIGNvbmZpZ1sncHJpbWFyeUtleSddW3Jlc291cmNlXSkge1xuICAgICAgcHJpbWFyeUtleSA9IGNvbmZpZ1sncHJpbWFyeUtleSddW3Jlc291cmNlXVxuICAgIH1cbiAgICByZXR1cm4gcHJpbWFyeUtleVxuICB9XG5cbiAgY29uc3QgYWRkRmlsdGVycyA9ICh3aGVyZSwgZmlsdGVyKSA9PiB7XG4gICAgaWYgKCFmaWx0ZXIpIHJldHVybiB3aGVyZVxuXG4gICAgY29uc3QgZmlsdGVyS2V5cyA9IE9iamVjdC5rZXlzKGZpbHRlcilcblxuICAgIGlmIChmaWx0ZXJLZXlzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHdoZXJlXG5cbiAgICBjb25zdCB3aGVyZUNvcHkgPSBPYmplY3QuYXNzaWduKHdoZXJlKVxuXG4gICAgZmlsdGVyS2V5cy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB3aGVyZUNvcHlba2V5XSA9IGZpbHRlcltrZXldXG4gICAgfSlcbiAgICByZXR1cm4gd2hlcmVDb3B5XG4gIH1cblxuICBjb25zdCBjb252ZXJ0RGF0YVJlcXVlc3RUb0hUVFAgPSAodHlwZSwgcmVzb3VyY2UsIHBhcmFtcykgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7fVxuICAgIGxldCBmaW5hbFF1ZXJ5ID0ge31cblxuICAgIGNvbnN0IHRhYmxlU2NoZW1hID0gZ2V0VGFibGVTY2hlbWEocmVzb3VyY2UpXG5cbiAgICBsZXQgeyBzY2hlbWEsIHRhYmxlTmFtZSB9ID0gdGFibGVTY2hlbWFcblxuICAgIGNvbnN0IHByaW1hcnlLZXkgPSBnZXRQcmltYXJ5S2V5KHJlc291cmNlKVxuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdHRVRfTElTVCc6XG4gICAgICAgIC8vIHNlbGVjdCBtdWx0aXBsZVxuICAgICAgICBjb25zdCBmaW5hbFNlbGVjdFF1ZXJ5ID0gY2xvbmVRdWVyeShzZWxlY3RRdWVyeSlcbiAgICAgICAgY29uc3QgZmluYWxDb3VudFF1ZXJ5ID0gY2xvbmVRdWVyeShjb3VudFF1ZXJ5KVxuXG4gICAgICAgIC8vIHNtYWxsIGhhY2ssIHRha2UgdGhlIFwicVwiIGZpbHRlciBhbmQgbW92ZSB0aGUgdmFsdWUgdG8gdGhlIHJvb3QuXG4gICAgICAgIGlmIChwYXJhbXMuZmlsdGVyICYmIHBhcmFtcy5maWx0ZXIucSkge1xuICAgICAgICAgIGNvbnN0IHsgcSB9ID0gcGFyYW1zLmZpbHRlclxuXG4gICAgICAgICAgZGVsZXRlIHBhcmFtcy5maWx0ZXJbJ3EnXVxuXG4gICAgICAgICAgcGFyYW1zLmZpbHRlciA9IHtcbiAgICAgICAgICAgIC4uLnBhcmFtcy5maWx0ZXIsXG4gICAgICAgICAgICAuLi5xXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZmluYWxTZWxlY3RRdWVyeS5hcmdzLnRhYmxlID0geyBuYW1lOiB0YWJsZU5hbWUsIHNjaGVtYTogc2NoZW1hIH1cbiAgICAgICAgZmluYWxTZWxlY3RRdWVyeS5hcmdzLmxpbWl0ID0gcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZVxuICAgICAgICBmaW5hbFNlbGVjdFF1ZXJ5LmFyZ3Mub2Zmc2V0ID1cbiAgICAgICAgICBwYXJhbXMucGFnaW5hdGlvbi5wYWdlICogcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZSAtXG4gICAgICAgICAgcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZVxuICAgICAgICBmaW5hbFNlbGVjdFF1ZXJ5LmFyZ3Mud2hlcmUgPSBwYXJhbXMuZmlsdGVyXG4gICAgICAgIGZpbmFsU2VsZWN0UXVlcnkuYXJncy5vcmRlcl9ieSA9IHtcbiAgICAgICAgICBjb2x1bW46IHBhcmFtcy5zb3J0LmZpZWxkIHx8IHByaW1hcnlLZXksXG4gICAgICAgICAgdHlwZTpcbiAgICAgICAgICAgIHR5cGVvZiBwYXJhbXMuc29ydC5vcmRlciA9PT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgICAgICAgPyAnYXNjJ1xuICAgICAgICAgICAgICA6IHBhcmFtcy5zb3J0Lm9yZGVyLnRvTG93ZXJDYXNlKClcbiAgICAgICAgfVxuICAgICAgICBmaW5hbENvdW50UXVlcnkuYXJncy50YWJsZSA9IHsgbmFtZTogdGFibGVOYW1lLCBzY2hlbWE6IHNjaGVtYSB9XG4gICAgICAgIGZpbmFsQ291bnRRdWVyeS5hcmdzLndoZXJlID0ge31cbiAgICAgICAgZmluYWxDb3VudFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICRuZTogbnVsbCB9XG4gICAgICAgIGZpbmFsQ291bnRRdWVyeS5hcmdzLndoZXJlID0gYWRkRmlsdGVycyhcbiAgICAgICAgICBmaW5hbENvdW50UXVlcnkuYXJncy53aGVyZSxcbiAgICAgICAgICBwYXJhbXMuZmlsdGVyXG4gICAgICAgIClcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoYnVsa1F1ZXJ5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucHVzaChmaW5hbFNlbGVjdFF1ZXJ5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucHVzaChmaW5hbENvdW50UXVlcnkpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdHRVRfT05FJzpcbiAgICAgICAgLy8gc2VsZWN0IG9uZVxuICAgICAgICBmaW5hbFF1ZXJ5ID0gY2xvbmVRdWVyeShzZWxlY3RRdWVyeSlcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnRhYmxlID0geyBuYW1lOiB0YWJsZU5hbWUsIHNjaGVtYTogc2NoZW1hIH1cbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLndoZXJlID0ge31cbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLndoZXJlW3ByaW1hcnlLZXldID0geyAkZXE6IHBhcmFtcy5pZCB9XG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdDUkVBVEUnOlxuICAgICAgICAvLyBjcmVhdGUgb25lXG4gICAgICAgIGNvbnN0IGNyZWF0ZUZpZWxkcyA9IE9iamVjdC5rZXlzKHBhcmFtcy5kYXRhKVxuXG4gICAgICAgIGZpbmFsUXVlcnkgPSBjbG9uZVF1ZXJ5KGluc2VydFF1ZXJ5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7IG5hbWU6IHRhYmxlTmFtZSwgc2NoZW1hOiBzY2hlbWEgfVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mub2JqZWN0cy5wdXNoKHBhcmFtcy5kYXRhKVxuICAgICAgICBjcmVhdGVGaWVsZHMucHVzaChwcmltYXJ5S2V5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucmV0dXJuaW5nID0gY3JlYXRlRmllbGRzXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdVUERBVEUnOlxuICAgICAgICAvLyB1cGRhdGUgb25lXG4gICAgICAgIGNvbnN0IHVwZGF0ZUZpZWxkcyA9IE9iamVjdC5rZXlzKHBhcmFtcy5kYXRhKVxuXG4gICAgICAgIGZpbmFsUXVlcnkgPSBjbG9uZVF1ZXJ5KHVwZGF0ZVF1ZXJ5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7IG5hbWU6IHRhYmxlTmFtZSwgc2NoZW1hOiBzY2hlbWEgfVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3NbJyRzZXQnXSA9IHBhcmFtcy5kYXRhXG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZSA9IHt9XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJGVxOiBwYXJhbXMuaWQgfVxuICAgICAgICB1cGRhdGVGaWVsZHMucHVzaChwcmltYXJ5S2V5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucmV0dXJuaW5nID0gdXBkYXRlRmllbGRzXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdVUERBVEVfTUFOWSc6XG4gICAgICAgIC8vIHVwZGF0ZSBtdWx0aXBsZSBpZHMgd2l0aCBnaXZlbiBkYXRhXG4gICAgICAgIGNvbnN0IHVwZGF0ZU1hbnlGaWVsZHMgPSBPYmplY3Qua2V5cyhwYXJhbXMuZGF0YSlcblxuICAgICAgICBmaW5hbFF1ZXJ5ID0gY2xvbmVRdWVyeSh1cGRhdGVRdWVyeSlcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnRhYmxlID0geyBuYW1lOiB0YWJsZU5hbWUsIHNjaGVtYTogc2NoZW1hIH1cbiAgICAgICAgZmluYWxRdWVyeS5hcmdzWyckc2V0J10gPSBwYXJhbXMuZGF0YVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmUgPSB7fVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICRpbjogcGFyYW1zLmlkcyB9XG4gICAgICAgIHVwZGF0ZU1hbnlGaWVsZHMucHVzaChwcmltYXJ5S2V5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucmV0dXJuaW5nID0gdXBkYXRlTWFueUZpZWxkc1xuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnREVMRVRFJzpcbiAgICAgICAgLy8gZGVsZXRlIG9uZVxuICAgICAgICBjb25zdCBkZWxldGVGaWVsZHMgPSBPYmplY3Qua2V5cyhwYXJhbXMucHJldmlvdXNEYXRhKVxuXG4gICAgICAgIGZpbmFsUXVlcnkgPSBjbG9uZVF1ZXJ5KGRlbGV0ZVF1ZXJ5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MudGFibGUgPSB7IG5hbWU6IHRhYmxlTmFtZSwgc2NoZW1hOiBzY2hlbWEgfVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmUgPSB7fVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3Mud2hlcmVbcHJpbWFyeUtleV0gPSB7ICRlcTogcGFyYW1zLmlkIH1cbiAgICAgICAgZGVsZXRlRmllbGRzLnB1c2gocHJpbWFyeUtleSlcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnJldHVybmluZyA9IGRlbGV0ZUZpZWxkc1xuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnREVMRVRFX01BTlknOlxuICAgICAgICAvLyBkZWxldGUgbXVsdGlwbGVcbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoZGVsZXRlUXVlcnkpXG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy50YWJsZSA9IHsgbmFtZTogdGFibGVOYW1lLCBzY2hlbWE6IHNjaGVtYSB9XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZSA9IHt9XG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJGluOiBwYXJhbXMuaWRzIH1cbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnJldHVybmluZyA9IFtwcmltYXJ5S2V5XVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAnR0VUX01BTlknOlxuICAgICAgICAvLyBzZWxlY3QgbXVsdGlwbGUgd2l0aGluIHdoZXJlIGNsYXVzZVxuICAgICAgICBjb25zdCBmaW5hbE1hbnlRdWVyeSA9IGNsb25lUXVlcnkoc2VsZWN0UXVlcnkpXG4gICAgICAgIGNvbnN0IGZpbmFsTWFueUNvdW50UXVlcnkgPSBjbG9uZVF1ZXJ5KGNvdW50UXVlcnkpXG5cbiAgICAgICAgZmluYWxNYW55UXVlcnkuYXJncy50YWJsZSA9IHsgbmFtZTogdGFibGVOYW1lLCBzY2hlbWE6IHNjaGVtYSB9XG4gICAgICAgIGZpbmFsTWFueVF1ZXJ5LmFyZ3Mud2hlcmUgPSB7fVxuICAgICAgICBmaW5hbE1hbnlRdWVyeS5hcmdzLndoZXJlW3ByaW1hcnlLZXldID0geyAkaW46IHBhcmFtcy5pZHMgfVxuICAgICAgICBmaW5hbE1hbnlRdWVyeS5hcmdzLndoZXJlID0gYWRkRmlsdGVycyhcbiAgICAgICAgICBmaW5hbE1hbnlRdWVyeS5hcmdzLndoZXJlLFxuICAgICAgICAgIHBhcmFtcy5maWx0ZXJcbiAgICAgICAgKVxuXG4gICAgICAgIGZpbmFsTWFueUNvdW50UXVlcnkuYXJncy50YWJsZSA9IHsgbmFtZTogdGFibGVOYW1lLCBzY2hlbWE6IHNjaGVtYSB9XG4gICAgICAgIGZpbmFsTWFueUNvdW50UXVlcnkuYXJncy53aGVyZSA9IHt9XG4gICAgICAgIGZpbmFsTWFueUNvdW50UXVlcnkuYXJncy53aGVyZVtwcmltYXJ5S2V5XSA9IHsgJG5lOiBudWxsIH1cbiAgICAgICAgZmluYWxNYW55Q291bnRRdWVyeS5hcmdzLndoZXJlID0gYWRkRmlsdGVycyhcbiAgICAgICAgICBmaW5hbE1hbnlDb3VudFF1ZXJ5LmFyZ3Mud2hlcmUsXG4gICAgICAgICAgcGFyYW1zLmZpbHRlclxuICAgICAgICApXG5cbiAgICAgICAgZmluYWxRdWVyeSA9IGNsb25lUXVlcnkoYnVsa1F1ZXJ5KVxuICAgICAgICBmaW5hbFF1ZXJ5LmFyZ3MucHVzaChmaW5hbE1hbnlRdWVyeSlcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnB1c2goZmluYWxNYW55Q291bnRRdWVyeSlcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgJ0dFVF9NQU5ZX1JFRkVSRU5DRSc6XG4gICAgICAgIC8vIHNlbGVjdCBtdWx0aXBsZSB3aXRoIHJlbGF0aW9uc1xuICAgICAgICBjb25zdCBmaW5hbE1hbnlSZWZRdWVyeSA9IGNsb25lUXVlcnkoc2VsZWN0UXVlcnkpXG4gICAgICAgIGNvbnN0IGZpbmFsTWFueVJlZkNvdW50UXVlcnkgPSBjbG9uZVF1ZXJ5KGNvdW50UXVlcnkpXG5cbiAgICAgICAgZmluYWxNYW55UmVmUXVlcnkuYXJncy50YWJsZSA9IHsgbmFtZTogdGFibGVOYW1lLCBzY2hlbWE6IHNjaGVtYSB9XG4gICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3MubGltaXQgPSBwYXJhbXMucGFnaW5hdGlvbi5wZXJQYWdlXG4gICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3Mub2Zmc2V0ID1cbiAgICAgICAgICBwYXJhbXMucGFnaW5hdGlvbi5wYWdlICogcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZSAtXG4gICAgICAgICAgcGFyYW1zLnBhZ2luYXRpb24ucGVyUGFnZVxuICAgICAgICBmaW5hbE1hbnlSZWZRdWVyeS5hcmdzLndoZXJlID0geyBbcGFyYW1zLnRhcmdldF06IHBhcmFtcy5pZCB9XG4gICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3Mud2hlcmUgPSBhZGRGaWx0ZXJzKFxuICAgICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3Mud2hlcmUsXG4gICAgICAgICAgcGFyYW1zLmZpbHRlclxuICAgICAgICApXG4gICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3Mub3JkZXJfYnkgPSB7XG4gICAgICAgICAgY29sdW1uOiBwYXJhbXMuc29ydC5maWVsZCB8fCBwcmltYXJ5S2V5LFxuICAgICAgICAgIHR5cGU6XG4gICAgICAgICAgICB0eXBlb2YgcGFyYW1zLnNvcnQub3JkZXIgPT09ICd1bmRlZmluZWQnXG4gICAgICAgICAgICAgID8gJ2FzYydcbiAgICAgICAgICAgICAgOiBwYXJhbXMuc29ydC5vcmRlci50b0xvd2VyQ2FzZSgpXG4gICAgICAgIH1cbiAgICAgICAgZmluYWxNYW55UmVmQ291bnRRdWVyeS5hcmdzLnRhYmxlID0geyBuYW1lOiB0YWJsZU5hbWUsIHNjaGVtYTogc2NoZW1hIH1cbiAgICAgICAgZmluYWxNYW55UmVmQ291bnRRdWVyeS5hcmdzLndoZXJlID0ge31cbiAgICAgICAgZmluYWxNYW55UmVmQ291bnRRdWVyeS5hcmdzLndoZXJlW3ByaW1hcnlLZXldID0geyAkbmU6IG51bGwgfVxuICAgICAgICBmaW5hbE1hbnlSZWZDb3VudFF1ZXJ5LmFyZ3Mud2hlcmUgPSBhZGRGaWx0ZXJzKFxuICAgICAgICAgIGZpbmFsTWFueVJlZlF1ZXJ5LmFyZ3Mud2hlcmUsXG4gICAgICAgICAgcGFyYW1zLmZpbHRlclxuICAgICAgICApXG4gICAgICAgIGZpbmFsUXVlcnkgPSBjbG9uZVF1ZXJ5KGJ1bGtRdWVyeSlcbiAgICAgICAgZmluYWxRdWVyeS5hcmdzLnB1c2goZmluYWxNYW55UmVmUXVlcnkpXG4gICAgICAgIGZpbmFsUXVlcnkuYXJncy5wdXNoKGZpbmFsTWFueVJlZkNvdW50UXVlcnkpXG4gICAgICAgIGJyZWFrXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHR5cGUgJHt0eXBlfWApXG4gICAgfVxuICAgIG9wdGlvbnMuYm9keSA9IEpTT04uc3RyaW5naWZ5KGZpbmFsUXVlcnkpXG4gICAgcmV0dXJuIHsgb3B0aW9ucyB9XG4gIH1cblxuICBjb25zdCBjb252ZXJ0SFRUUFJlc3BvbnNlID0gKHJlc3BvbnNlLCB0eXBlLCByZXNvdXJjZSwgcGFyYW1zKSA9PiB7XG4gICAgLy8gaGFuZGxlIGVycm9ycyBhbmQgdGhyb3cgd2l0aCB0aGUgbWVzc2FnZVxuICAgIGlmICgnZXJyb3InIGluIHJlc3BvbnNlIHx8ICdjb2RlJyBpbiByZXNwb25zZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSlcbiAgICB9XG4gICAgY29uc3QgcHJpbWFyeUtleSA9IGdldFByaW1hcnlLZXkocmVzb3VyY2UpXG5cbiAgICBpZiAocHJpbWFyeUtleSAhPT0gREVGQVVMVF9QUklNQVJZX0tFWSkge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzcG9uc2VbMF0pKSB7XG4gICAgICAgIHJlc3BvbnNlWzBdLmZvckVhY2gocmVzID0+IHtcbiAgICAgICAgICByZXNbREVGQVVMVF9QUklNQVJZX0tFWV0gPSByZXNbcHJpbWFyeUtleV1cbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3BvbnNlWzBdW0RFRkFVTFRfUFJJTUFSWV9LRVldID0gcmVzcG9uc2VbMF1bcHJpbWFyeUtleV1cbiAgICAgIH1cbiAgICB9XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdHRVRfTElTVCc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2VbMF0sXG4gICAgICAgICAgdG90YWw6IHJlc3BvbnNlWzFdWydjb3VudCddXG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ0dFVF9PTkUnOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHJlc3BvbnNlWzBdXG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ0NSRUFURSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2UucmV0dXJuaW5nWzBdXG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ1VQREFURSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2UucmV0dXJuaW5nWzBdXG4gICAgICAgIH1cbiAgICAgIGNhc2UgJ1VQREFURV9NQU5ZJzpcbiAgICAgICAgY29uc3QgdXBkYXRlZElkcyA9IHJlc3BvbnNlLnJldHVybmluZy5tYXAoaXRlbSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW0uaWRcbiAgICAgICAgfSlcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRhdGE6IHVwZGF0ZWRJZHNcbiAgICAgICAgfVxuICAgICAgY2FzZSAnREVMRVRFJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYXRhOiByZXNwb25zZS5yZXR1cm5pbmdbMF1cbiAgICAgICAgfVxuICAgICAgY2FzZSAnREVMRVRFX01BTlknOlxuICAgICAgICBjb25zdCBkZWxldGVkSWRzID0gcmVzcG9uc2UucmV0dXJuaW5nLm1hcChpdGVtID0+IHtcbiAgICAgICAgICByZXR1cm4gaXRlbS5pZFxuICAgICAgICB9KVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogZGVsZXRlZElkc1xuICAgICAgICB9XG4gICAgICBjYXNlICdHRVRfTUFOWSc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZGF0YTogcmVzcG9uc2VbMF1cbiAgICAgICAgfVxuICAgICAgY2FzZSAnR0VUX01BTllfUkVGRVJFTkNFJzpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkYXRhOiByZXNwb25zZVswXSxcbiAgICAgICAgICB0b3RhbDogcmVzcG9uc2VbMV0uY291bnRcbiAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHsgZGF0YTogcmVzcG9uc2UgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiAodHlwZSwgcmVzb3VyY2UsIHBhcmFtcykgPT4ge1xuICAgIGNvbnN0IHsgb3B0aW9ucyB9ID0gY29udmVydERhdGFSZXF1ZXN0VG9IVFRQKHR5cGUsIHJlc291cmNlLCBwYXJhbXMpXG5cbiAgICBvcHRpb25zLm1ldGhvZCA9ICdQT1NUJ1xuICAgIGlmICh0eXBlb2YgaHR0cENsaWVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgLy8gc3VwcG9ydCBodHRwQ2xpZW50IGFyZ3VtZW50XG4gICAgICByZXR1cm4gaHR0cENsaWVudChzZXJ2ZXJFbmRwb2ludCArICcvdjEvcXVlcnknLCBvcHRpb25zKS50aGVuKHJlc3BvbnNlID0+XG4gICAgICAgIGNvbnZlcnRIVFRQUmVzcG9uc2UocmVzcG9uc2UuanNvbiwgdHlwZSwgcmVzb3VyY2UsIHBhcmFtcylcbiAgICAgIClcbiAgICB9XG5cbiAgICBvcHRpb25zLmhlYWRlcnMgPSBodHRwQ2xpZW50IC8vIGJhY2t3YXJkcyBjb21wYXRpYmxlIHN0YXRpYyBoZWFkZXIgb2JqZWN0XG4gICAgcmV0dXJuIGZldGNoKHNlcnZlckVuZHBvaW50ICsgJy92MS9xdWVyeScsIG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24oXG4gICAgICByZXNwb25zZVxuICAgICkge1xuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKS50aGVuKGRhdGEgPT4ge1xuICAgICAgICByZXR1cm4gY29udmVydEhUVFBSZXNwb25zZShkYXRhLCB0eXBlLCByZXNvdXJjZSwgcGFyYW1zKVxuICAgICAgfSlcbiAgICB9KVxuICB9XG59XG4iLCIvLyBkZWZpbmUgaGFzdXJhIGpzb24gYXBpIHF1ZXJpZXNcbmNvbnN0IGJ1bGtRdWVyeSA9IHtcbiAgdHlwZTogJ2J1bGsnLFxuICBhcmdzOiBbXVxufTtcblxuY29uc3Qgc2VsZWN0UXVlcnkgPSB7XG4gIHR5cGU6ICdzZWxlY3QnLFxuICBhcmdzOiB7XG4gICAgdGFibGU6IHsnc2NoZW1hJzogJycsICduYW1lJzogJyd9LFxuICAgIGNvbHVtbnM6IFsnKiddXG4gIH1cbn07XG5cbmNvbnN0IGNvdW50UXVlcnkgPSB7XG4gIHR5cGU6ICdjb3VudCcsXG4gIGFyZ3M6IHtcbiAgICB0YWJsZTogeydzY2hlbWEnOiAnJywgJ25hbWUnOiAnJ30sXG4gICAgd2hlcmU6IHt9XG4gIH1cbn07XG5cbmNvbnN0IGluc2VydFF1ZXJ5ID0ge1xuICB0eXBlOiAnaW5zZXJ0JyxcbiAgYXJnczoge1xuICAgIHRhYmxlOiB7J3NjaGVtYSc6ICcnLCAnbmFtZSc6ICcnfSxcbiAgICBvYmplY3RzOiBbXSxcbiAgICByZXR1cm5pbmc6IFtdXG4gIH1cbn07XG5cbmNvbnN0IHVwZGF0ZVF1ZXJ5ID0ge1xuICB0eXBlOiAndXBkYXRlJyxcbiAgYXJnczoge1xuICAgIHRhYmxlOiB7J3NjaGVtYSc6ICcnLCAnbmFtZSc6ICcnfSxcbiAgICAkc2V0OiB7fSxcbiAgICB3aGVyZToge30sXG4gICAgcmV0dXJuaW5nOiBbXVxuICB9XG59O1xuXG5jb25zdCBkZWxldGVRdWVyeSA9IHtcbiAgdHlwZTogJ2RlbGV0ZScsXG4gIGFyZ3M6IHtcbiAgICB0YWJsZTogeydzY2hlbWEnOiAnJywgJ25hbWUnOiAnJ30sXG4gICAgJHNldDoge30sXG4gICAgd2hlcmU6IHt9LFxuICAgIHJldHVybmluZzogW11cbiAgfVxufTtcblxuZXhwb3J0IHsgYnVsa1F1ZXJ5LCBzZWxlY3RRdWVyeSwgY291bnRRdWVyeSwgaW5zZXJ0UXVlcnksIHVwZGF0ZVF1ZXJ5LCBkZWxldGVRdWVyeSB9O1xuXG4iXSwic291cmNlUm9vdCI6IiJ9